---
# ========================================
# cPanel Git Deployment Configuration
# ========================================
# 
# Acest fi»ôier instruie»ôte cPanel CE sƒÉ:
# 1. Clone/Pull din GitHub
# 2. Copieze DOAR wp-content/ √Æn loca»õia corectƒÉ
# 3. Ignore tot restul (WordPress core, documenta»õie, etc.)
#
# Deployment automat: cPanel ‚Üí Git Version Control ‚Üí Pull/Deploy
# ========================================

deployment:
  tasks:
    # ========================================
    # TASK 1: Backup √Ænainte de deploy (SAFETY)
    # ========================================
    - export TIMESTAMP=$(date +%Y%m%d_%H%M%S)
    - export BACKUP_DIR=$HOME/backups
    - mkdir -p $BACKUP_DIR
    - echo "üíæ Creating backup..."
    - tar -czf $BACKUP_DIR/wp-content-backup-$TIMESTAMP.tar.gz $HOME/public_html/test/wp-content 2>/dev/null || true
    - echo "‚úÖ Backup saved: wp-content-backup-$TIMESTAMP.tar.gz"
    
    # ========================================
    # TASK 2: Deploy PLUGINS (SursƒÉ ad√¢ncƒÉ: app/public/wp-content/)
    # ========================================
    - echo "üîÑ Deploying plugins from deep path..."
    
    # Plugin 1: webgsm-b2b-pricing
    - /bin/cp -rf $HOME/repositories/webgsm/app/public/wp-content/plugins/webgsm-b2b-pricing $HOME/public_html/test/wp-content/plugins/
    
    # Plugin 2: webgsm-checkout-pro
    - /bin/cp -rf $HOME/repositories/webgsm/app/public/wp-content/plugins/webgsm-checkout-pro $HOME/public_html/test/wp-content/plugins/
    
    # Plugin 3: webgsm-customer-tiers
    - /bin/cp -rf $HOME/repositories/webgsm/app/public/wp-content/plugins/webgsm-customer-tiers $HOME/public_html/test/wp-content/plugins/
    
    - echo "‚úÖ Plugins deployed!"
    
    # ========================================
    # TASK 3: Deploy THEME (SursƒÉ ad√¢ncƒÉ: app/public/wp-content/)
    # ========================================
    - echo "üîÑ Deploying theme from deep path..."
    - /bin/cp -rf $HOME/repositories/webgsm/app/public/wp-content/themes/martfury-child $HOME/public_html/test/wp-content/themes/
    - echo "‚úÖ Theme deployed!"
    
    # ========================================
    # TASK 4: Cleanup (»ôterge fi»ôiere temporare)
    # ========================================
    - echo "üßπ Cleaning up..."
    
    # »òterge documenta»õie din plugins/themes (dacƒÉ s-a copiat accidental)
    - find $HOME/public_html/test/wp-content/plugins/ -name "*.md" -type f -delete 2>/dev/null || true
    - find $HOME/public_html/test/wp-content/themes/martfury-child/ -name "*.md" -type f -delete 2>/dev/null || true
    
    # »òterge .git metadata (dacƒÉ existƒÉ)
    - find $HOME/public_html/test/wp-content/plugins/ -name ".git" -type d -exec rm -rf {} + 2>/dev/null || true
    - find $HOME/public_html/test/wp-content/themes/ -name ".git" -type d -exec rm -rf {} + 2>/dev/null || true
    
    # »òterge node_modules (dacƒÉ existƒÉ)
    - find $HOME/public_html/test/wp-content/plugins/ -name "node_modules" -type d -exec rm -rf {} + 2>/dev/null || true
    - find $HOME/public_html/test/wp-content/themes/ -name "node_modules" -type d -exec rm -rf {} + 2>/dev/null || true
    
    - echo "‚úÖ Cleanup done!"
    
    # ========================================
    # TASK 5: Set permissions (SIGUR pentru WordPress)
    # ========================================
    - echo "üîí Setting permissions..."
    
    # Folders: 755 (rwxr-xr-x)
    - find $HOME/public_html/test/wp-content/plugins/ -type d -exec chmod 755 {} \;
    - find $HOME/public_html/test/wp-content/themes/martfury-child/ -type d -exec chmod 755 {} \;
    
    # Files: 644 (rw-r--r--)
    - find $HOME/public_html/test/wp-content/plugins/ -type f -exec chmod 644 {} \;
    - find $HOME/public_html/test/wp-content/themes/martfury-child/ -type f -exec chmod 644 {} \;
    
    - echo "‚úÖ Permissions set!"
    
    # ========================================
    # TASK 6: Clear WordPress cache & Force plugin reload
    # ========================================
    - echo "üóëÔ∏è Clearing cache & forcing plugin reload..."
    
    # »òterge cache-ul de transients/object cache
    - rm -rf $HOME/public_html/test/wp-content/cache/* 2>/dev/null || true
    
    # Touch plugin file pentru a for»õa reload
    - touch $HOME/public_html/test/wp-content/plugins/webgsm-b2b-pricing/webgsm-b2b-pricing.php
    
    # WP-CLI cache flush (dacƒÉ ai WP-CLI instalat)
    - cd $HOME/public_html/test && wp cache flush 2>/dev/null || echo "‚ö†Ô∏è WP-CLI not available (manual cache clear needed)"
    
    # ========================================
    # FINAL: Success message
    # ========================================
    - echo ""
    - echo "========================================="
    - echo "‚úÖ DEPLOYMENT COMPLETE!"
    - echo "========================================="
    - echo "üì¶ Plugins deployed:"
    - echo "   - webgsm-b2b-pricing"
    - echo "   - webgsm-checkout-pro"
    - echo "   - webgsm-customer-tiers"
    - echo ""
    - echo "üé® Theme deployed:"
    - echo "   - martfury-child"
    - echo ""
    - echo "üíæ Backup location:"
    - echo "   $BACKUP_DIR/wp-content-backup-$TIMESTAMP.tar.gz"
    - echo ""
    - echo "üåê Check your site:"
    - echo "   https://your-domain.com"
    - echo "========================================="
